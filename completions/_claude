#compdef claude

# Claude Code CLI completion

_claude() {
  local -a commands
  local -a options

  commands=(
    'doctor:Check the health of your Claude Code auto-updater'
    'install:Install Claude Code native build'
    'mcp:Configure and manage MCP servers'
    'plugin:Manage Claude Code plugins'
    'setup-token:Set up a long-lived authentication token'
    'update:Check for updates and install if available'
  )

  options=(
    '--add-dir[Additional directories to allow tool access to]:directories:_files -/'
    '--agent[Agent for the current session]:agent:'
    '--agents[JSON object defining custom agents]:json:'
    '--allow-dangerously-skip-permissions[Enable bypassing all permission checks]'
    '--allowed-tools[Comma or space-separated list of tool names to allow]:tools:'
    '--append-system-prompt[Append a system prompt]:prompt:'
    '--betas[Beta headers to include in API requests]:betas:'
    '--chrome[Enable Claude in Chrome integration]'
    {-c,--continue}'[Continue the most recent conversation]'
    '--dangerously-skip-permissions[Bypass all permission checks]'
    {-d,--debug}'[Enable debug mode with optional category filtering]:filter:'
    '--disable-slash-commands[Disable all skills]'
    '--disallowed-tools[Comma or space-separated list of tool names to deny]:tools:'
    '--fallback-model[Enable automatic fallback to specified model]:model:'
    '--file[File resources to download at startup]:specs:'
    {-h,--help}'[Display help for command]'
    '--ide[Automatically connect to IDE on startup]'
    '--include-partial-messages[Include partial message chunks]'
    '--input-format[Input format]:format:(text stream-json)'
    '--json-schema[JSON Schema for structured output validation]:schema:'
    '--max-budget-usd[Maximum dollar amount to spend on API calls]:amount:'
    '--mcp-config[Load MCP servers from JSON files or strings]:configs:_files'
    '--mcp-debug[Enable MCP debug mode]'
    '--model[Model for the current session]:model:(sonnet opus haiku claude-sonnet-4-5-20250929 claude-opus-4-5-20251101)'
    '--no-chrome[Disable Claude in Chrome integration]'
    '--no-session-persistence[Disable session persistence]'
    '--output-format[Output format]:format:(text json stream-json)'
    '--permission-mode[Permission mode to use]:mode:(acceptEdits bypassPermissions default delegate dontAsk plan)'
    '--plugin-dir[Load plugins from directories]:paths:_files -/'
    {-p,--print}'[Print response and exit]'
    '--replay-user-messages[Re-emit user messages from stdin]'
    {-r,--resume}'[Resume a conversation by session ID]:session:'
    '--session-id[Use a specific session ID]:uuid:'
    '--setting-sources[Comma-separated list of setting sources]:sources:'
    '--settings[Path to a settings JSON file]:file:_files'
    '--strict-mcp-config[Only use MCP servers from --mcp-config]'
    '--system-prompt[System prompt to use]:prompt:'
    '--tools[Specify the list of available tools]:tools:'
    '--verbose[Override verbose mode setting]'
    {-v,--version}'[Output the version number]'
  )

  _arguments -s \
    $options \
    '1: :->cmd' \
    '*::arg:->args'

  case $state in
    cmd)
      _describe -t commands 'claude commands' commands
      ;;
    args)
      case $words[1] in
        install)
          _arguments \
            '1:target:(stable latest)'
          ;;
        mcp)
          _arguments \
            '1:subcommand:(add remove list)'
          ;;
        plugin)
          _arguments \
            '1:subcommand:(add remove list)'
          ;;
      esac
      ;;
  esac
}

_claude "$@"
